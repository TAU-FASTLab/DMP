  /* Open issues, code not ready  */
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Data Protection Form</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
<style>
  /* Add CSS styles to match the picture as closely as possible */
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  .form-title {
    background-color: #660099;
    color: white;
    padding: 10px;
    text-align: center;
  }
  .form-section {
    border: 1px solid black;
    margin-top: 10px;
    padding: 10px;
  }
  .required {
    color: red;
}
  .button {
    display: block;
    margin-top: 20px;
  }
  #dpiTemplateLink {
    color: #0000EE; /* Blue color like standard link */
    text-decoration: none; /* No underline by default */
  }
  #dpiTemplateLink:hover {
    text-decoration: underline; /* Underline on hover */
  }
  .article {
    background-color: #f3d4f9;
    border: 1px solid #5c0567;
    padding: 20px;
    margin: 20px 0;
  }
  .article h2 {
    background-color: #e7e7e7;
    padding: 10px;
    margin-top: 0;
  }
  .article ol {
    padding-left: 20px;
  }
  .article ol li {
    margin-bottom: 10px;
  }
  #additionalFormLegitimateInterest {
    display: none; /* Hide the form by default */
  }
</style>
</head>
<body>
    <div class="form-title"><h1>Define Legal Basis for Processing Personal Data </h1></div>
    <form id="dataProtectionForm">
      <!-- 1. Processing of personal data -->
        <div class="form-section">
            <h2>Legal Bases</h2>
            <p>This section try to address the following question:
              What is the reason or justification for processing personal data? </p>
              <p>Article 6 of the General Data Protection Regulation (GDPR) sets out what these potential 
                legal bases are, namely: <strong>consent; contract; legal obligation; vital interests; public task; or 
                legitimate interests</strong>.</p>               

              <div class="article">
                <h4>                  
                  <a href= https://gdpr-info.eu/art-6-gdpr/  target="_blank" id="gdprLink"> Article 6 GDPR, Lawfulness of processing: </a>
                </h4>
                <ol>
                    <li>Processing shall be lawful only if and to the extent that at least one of the following applies:
                        <ol type="a">
                            <li>the data subject has given consent to the processing of his or her personal data for one or more specific purposes;</li>
                            <li>processing is necessary for the performance of a contract to which the data subject is party or in order to take steps at the request of the data subject prior to entering into a contract;</li>
                            <li>processing is necessary for compliance with a legal obligation to which the controller is subject;</li>
                            <li>processing is necessary in order to protect the vital interests of the data subject or of another natural person;</li>
                            <li>processing is necessary for the performance of a task carried out in the public interest or in the exercise of official authority vested in the controller;</li>
                            <li>processing is necessary for the purposes of the legitimate interests pursued by the controller or by a third party, except where such interests are overridden by the interests or fundamental rights and freedoms of the data subject which require protection of personal data, in particular where the data subject is a child.</li>
                        </ol>
                        <p>Point (f) of the first subparagraph shall not apply to processing carried out by public authorities in the performance of their tasks.</p>
                    </li>
                </ol>
            </div>
            <p>Further information:
              <a href= https://www.dataprotection.ie/sites/default/files/uploads/2020-04/Guidance%20on%20Legal%20Bases.pdf target="_blank" id="dpiTemplateLink"> Guidance on Legal Bases for Processing Personal Data </a>
            </p>

            <label for="legalBases"><strong>Choose a legal base:<span class="required">*</span></strong></label>
            <select name="legalBases" id="legalBases" required onchange="showForm()">
              <option value="">Please select</option>
              <option value="Consent">Consent</option>
              <option value="Contract">Contract</option>
              <option value="Legal Obligation">Legal Obligation</option>
              <option value="Vital Interests">Vital Interests</option>
              <option value="Public Task">Public Task</option>
              <option value="Legitimate Interest">Legitimate Interest</option>
            </select>

            <script>
              function showForm() {
                var selectBox = document.getElementById('legalBases');
                var selectedValue = selectBox.options[selectBox.selectedIndex].value;
                var additionalForm = document.getElementById('additionalFormLegitimateInterest');
              
                if(selectedValue === 'Legitimate Interest') {
                  additionalForm.style.display = 'block';
                } else {
                  additionalForm.style.display = 'none';
                }
              }
              </script> 
                          
            <div id="additionalFormLegitimateInterest">
              <!-- Add your form fields here as per the image you've uploaded -->
              <p>If Legitimate Interest is selected, the Balance Test must to be filled</p>
              <h3>BALANCE TEST: THE DATA CONTROLLER’S LEGITIMATE INTEREST AS A LEGAL BASIS FOR PROCESSING PERSONAL DATA</h3>
              <p>The EU’s General Data Protection Regulation (GDPR, EU 2016/679)</p>
              <p>The lawful basis for processing personal data may be the legitimate interests of the data controller or a third party. 
                If you choose to rely on legitimate interests, you are taking on extra responsibility for considering and protecting the 
                rights and freedoms of the individuals whose data you are processing. Interests are more likely to be legitimate when there
                is a relevant and appropriate relationship between the data controller and the individuals who can be, for example, 
                customers, students or employees. The data controller must carry out a balancing test to ensure that individuals’ rights
                and interests do not override the data controller’s legitimate interests to process their data.</p>
              <p><h4>Description of processing</h4></p>
                                
              <form id="legitimateInterestForm">
              <label for="categoriesOfPersonalData">List the categories and types of personal data that you will process:<span class="required">*</span></label>
              <br>
                <textarea id="categoriesOfPersonalData" name="categoriesOfPersonalData" rows="7" cols="50" required placeholder=" Enter text here..."></textarea>
                <br>
                <br>
                <label for="purposeOfPersonalData">Purpose/purposes of processing personal data:<span class="required">*</span></label>
                <br>
                <textarea id="purposeOfPersonalData" name="purposeOfPersonalData" rows="7" cols="50" required placeholder=" Enter text here..."></textarea>
                <br>
                <label for="storeOfPersonalData">Where will personal data be stored (system/records)? Who will process personal data?
                  Provide the name or other identifier of a possible research project.
                <span class="required">*</span>
                </label>
                <br>
                <textarea id="storeOfPersonalData" name="storeOfPersonalData" rows="7" cols="50" required placeholder=" Enter text here..."></textarea>
                <br>
                <label for="otherInformation">Other information (for example, will you be processing personal data relating to children?).</label>
                <br>
                <textarea id="otherInformation" name="otherInformation" rows="7" cols="50" required placeholder=" Enter text here..."></textarea>
                <br>
                <p><h4>Balancing test</h4></p> 
                <label for="legitimateInterestYes">                      
                      1. Is legitimate interests the most appropriate basis for processing personal data? <span class="required">*</span> 
                </label>
                <br>
                <label><input type="radio" name="balanceTestSection1" value="Yes" id="legitimateInterestYes" onclick="legitimateInterestToggle()"> Yes</label>
                <label><input type="radio" name="balanceTestSection1" value="No" id="legitimateInterestNo"  onclick="legitimateInterestToggle()"> No</label>
                <div>If "No," points 2 to 5 do not need to be filled, and thus they are not displayed.</div>
                <script>
                      // Function to toggle the visibility of Section 3 in case that Yes is selected
                      function legitimateInterestToggle() {
                        var legitimateInterestToggleChecked = document.getElementById('legitimateInterestYes').checked;
                        var legitimateInterest = document.getElementById('balancingTestSection2');
                        legitimateInterest.style.display = legitimateInterestToggleChecked ? 'block' : 'none';
                      }      
                    </script>

                    <div id="balancingTestSection2" style="display:none;">
                    <p> 
                    If yes, please specify 
                    (or describe why the appropriate legal basis is not, for example, contract or consent).<span class="required">*</span>
                    </p>
                    <label>
                    <textarea id="appropriatedBasis" name="appropriatedBasis" rows="7" cols="50" required placeholder=" Enter text here..."></textarea>
                    </label>
                    <label for="legalInterest">

                      <legend>2. Are all the basic requirements met for the data controller’s interests to be considered legitimate? Demonstrate compliance with the following basic requirements:<span class="required">*</span></legend>
                      <ul>
                          <li>The interest must be legal (in compliance with EU or national law).
                            <label for="legalInterest">Please Explain it below: </label> 
                            <br> 
                             <textarea id="legalInterest" name="legalInterest" rows="7" cols="50" required placeholder="Enter text here..."></textarea>
                            <br>
                          </li>
                          <li>The interest must be clearly stated so that its balance with the data subjects’ rights and interests can be assessed.
                            <label for="clearInterest">Please Explain it below:</label>
                            <br> 
                              <textarea id="clearInterest" name="clearInterest" rows="7" cols="50" required placeholder="Enter text here..."></textarea>
                            <br>                              
                          </li>  
                          <li>The interest must represent a genuine and direct need; it cannot be speculative.
                            <label for="genuineInterest"> Please Explain it below: </label>
                            <br> 
                              <textarea id="genuineInterest" name="genuineInterest" rows="7" cols="50" required placeholder="Enter text here..."></textarea>
                            <br>
                          </li>                          
                      </ul>
 
                     <br>              
                     </label>
                  <label for="allRequirementsMetYes">                      
                    Are all the requirements met? <span class="required">*</span> 
                  </label>
                  <br>
                  <label><input type="radio" name="allRequirementsMet" value="Yes" id="allRequirementsMetYes" onclick="toggleSection3()"> Yes</label>
                  <label><input type="radio" name="allRequirementsMet" value="No" id="allRequirementsMetNo"  onclick="toggleSection3()"> No</label>
                  <script>
                    // Function to toggle the visibility of Section 3 in case that Yes is selected
                    function toggleSection3() {
                      var RequirementsMetChecked = document.getElementById('allRequirementsMetYes').checked;
                      var lessIntrusive = document.getElementById('lessIntrusiveSection');
                      lessIntrusiveSection.style.display = RequirementsMetChecked ? 'block' : 'none';
                    }      
                  </script>
                   
                  <div id="lessIntrusiveSection" style="display:none;">
                  <label for="achieveLessIntrusiveNo">
                    <p>3. Could the same result be achieved in a way that is less intrusive?.<span class="required">*</span></p>
                    <!-- If this is not possible, go to section 4 -->
                  </label> 
                  <label><input type="radio" name="achieveLessIntrusive" value="Yes" id="achieveLessIntrusiveYes" onclick="toggleSection4()"> Yes</label>
                  <label><input type="radio" name="achieveLessIntrusive" value="No" id="achieveLessIntrusiveNo"  onclick="toggleSection4()"> No </label>
                  <script>
                    // Function to toggle the visibility of Section 3 in case that Yes is selected
                    function toggleSection4() {
                      var achieveLessIntrusiveChecked = document.getElementById('achieveLessIntrusiveNo').checked;
                      var impactOfProcessingSection = document.getElementById('impactOfProcessingSection');
                      impactOfProcessingSection.style.display = achieveLessIntrusiveChecked ? 'block' : 'none';
                    }      
                  </script>               
                  <br>
          
                  <label for="lessIntrusive"> Please explain your answer.<span class="required">*</span></label>
                    <br>
                    <textarea id="lessIntrusive" name="lessIntrusive" rows="7" cols="50" required placeholder=" Enter text here..."></textarea>                  
                  <br>
                  <div id="impactOfProcessingSection" style="display:none;">     
                  <label for="impactOfProcessing">
                    <p>
                      4. Assess the impact of processing <span class="required">*</span>
                      <p>A. Answer the following questions to determine whether the interests of a data controller or a third party override data subjects’ rights and interests:</p>
                      <ul>
                      <li> Describe the interests of the data controller or a third party. </li>
                      <li> What benefit would the processing of personal data provide? </li>
                      <li> What harm could come from not processing the personal data?</li>
                      </ul>
                      
                      B. Assess the impact of processing on data subjects:
                      <ul>
                      <li>Describe the nature of the personal data to be processed.</li>
                      <li>How would personal data be processed (such as large-scale processing, aggregation, data mining, profiling, publication)?</li>
                      <li>How would the processing activities impact data subjects?</li>
                      <li>Could data subjects reasonably expect this type of processing to take place?</li>
                      <li>Would it be likely that data subjects would object to the processing or at least find it questionable?</li>                     
                      </ul>
                      C. Assess the position of data subjects:
                      <ul>
                      <li>What is the relationship between the data controller and data subjects?</li>
                      <li>Are you planning to process children’s personal data?</li>
                      <li>Are data subjects in an otherwise vulnerable position?</li>
                      </ul>  
                    <p>
                      SECTION 4. CONSIDER THE FOLLOWING POINTS WHEN YOU CONDUCT THE ASSESSMENT: As set out in the GDPR and the instructions provided by data protection authorities, a data controller’s interests may be considered legitimate if the processing of personal data is necessary for exercising a fundamental right. In addition, the processing must be a proportionate means of achieving a legitimate aim. Interests may also be considered legitimate if processing almost falls under a different condition (such as the “contract” condition). It also makes a difference whether EU or national legislation or other regulations acknowledge the data controller's legitimate interests to process personal data.  

                      When you are assessing the impacts of processing on data subjects, you must consider both concrete and potential impacts, such as any future decision, actions or circumstances where processing may lead to discrimination against an individual as well as the risk of causing distress or upset. It is also important to consider the likelihood and severity of the impact on the rights and freedoms of data subjects. 
                      
                      The data protection authorities have emphasised that the compensating controls or measures that can be put in place to protect data (such as assessing the balance between lawful data access and privacy, openness and transparency) support the use of legitimate interests as the legal basis for processing. If there may be an imbalance between the interests of the data controller and data subjects, the situation must be carefully assessed and any further measures that could be taken to reduce any potentially negative impacts of processing must be identified.
                    </p>
                    </p>
                    </label>                 
                    <textarea id="impactOfProcessing" name="impactOfProcessing" rows="7" cols="50" required placeholder=" Enter text here..."></textarea>
                    <br>
                    <br>
                    <label for="rightsAndInterestYes">
                    Do the rights and interests of data subjects not outweigh the data controller’s legitimate interests? <span class="required">*</span>
                    </label>
                    <br>
                    <label><input type="radio" name="rightsAndInterest" id="rightsAndInterestYes" onclick="toggleSection5()">Yes</label>
                    <label><input type="radio" name="rightsAndInterest" id="rightsAndInterestNo" onclick="toggleSection5()">No</label>
                    <p>If Not, point 5 does not need to be filled, thus it is not displayed.</p> 
                    <script>
                      function toggleSection5(){
                        var rightsAndInterestYesRadio = document.getElementById('rightsAndInterestYes').checked;
                        var additionalSafeguardsSection = document.getElementById('additionalSafeguardsSection');
                        additionalSafeguardsSection.style.display = rightsAndInterestYesRadio ? 'block': 'none';
                      } 
                    </script>
                    <div id="additionalSafeguardsSection" style="display:none;"> 
                    <label for="additionalSafeguards">
                    <p> 5. Additional safeguards <span class="required">*</span></p></label>
                    <p>
                      The result of the balancing test depend on an overall assessment: the greater the impact of processing on data subjects, the more safeguards must be put in place to protect data. The safeguards must significantly and reliably reduce any risks or potentially negative impacts of processing.
                      What safeguards have been and/or will be put in place to mitigate risks? Possible additional safeguards include: 
                      <ul>
                      <li>technical and organisational measures that ensure data will not be used to make decisions concerning data subjects or for other purposes (functional separation);</li>
                      <li>anonymisation or pseudonymisation;</li>
                      <li>the encryption of personal data.</li>
                      </ul>
                    </p> </label>            
                  <textarea id="additionalSafeguards" name="additionalSafeguards" rows="7" cols="50" required placeholder=" Enter text here..."></textarea> 
                  <br> 
                
                </div>               
                </div>
                </div>
                </div>

                  <label for="informingDataSubjects">
                  <p> 6. Informing data subjects of processing and their right to object Assess whether the following requirements are met:<span class="required">*</span> </p>
                  <p>
                  <ul class="custom-letter-list">
                   <li>Data subjects have been informed of their right to object to the processing of their personal data no later when they are contacted for the first time. </li>

                   <li>Information about the right to object was presented clearly and separately from other communications. </li>

                   <li>Data subjects are able to opt of receiving direct marketing.</li>

                   <li> If necessary, it is possible to determine whether there is a compelling and justified reason for processing personal data, 
                    which overrides the rights and interests of data subjects or is necessary for the establishment, exercise or defence of legal 
                    claims.</li>
                   </ul>
                  </p> 
                  <p>
                    SECTION 6. CONSIDER THE FOLLOWING POINTS WHEN YOU CONDUCT THE ASSESSMENT: When the processing of personal data is based on public or legitimate 
                    interests, data subjects have the right to object to the processing of their data at any time. Data subjects must be informed of this right no later
                     than when they are contacted for the first time. The information must be presented clearly and separately from other communications. 
                    If data subjects object to the processing of their data, the necessity of processing must be re-evaluated. As a rule, their personal data can no 
                    longer be processed unless: 
                    <ul>
                    <li> you are able to demonstrate that there is a compelling and justified reason for the processing, which overrides the rights and interests of data
                       subjects (such as a task in the public interest that requires scientific or historical research or the compilation of statistics); or</li>
                    <li>the processing is necessary for the establishment, exercise or defence of legal claims.</li>
                    </ul>
                  </label>                 
                <textarea id="informingDataSubjects" name="informingDataSubjects" rows="7" cols="50" required placeholder=" Enter text here..."></textarea>
                  <br>
                  <p><h4>Overall assessment <span class="required">*</span></h4></p>    
              
                <label for="legalBasescanOrcannot">Based on the balancing test, legitimate interests
                <select name="legalBasescanOrcannot" id="legalBasescanOrcannot" required onchange="showForm()">
                  <option value="">Please select</option>
                  <option value="canBeUsed">can be used</option>
                  <option value="cannotBeUsed">cannot be used</option>
                </select>
                as the lawful basis for processing the types of personal data referred to above.<span class="required">*</span></strong>
              </label>
          <p> 
           <h4>Date, Place and Signature <span class="required">*</span></h4>       
          <label for="place">Place:<span class="required">*</span></label>
          <input type="text" id="place" name="place" required>
          </p>
          <p>  
          <label for="date">Date:<span class="required">*</span></label>
          <input type="date" id="date" name="date" required>
          </p>
          <p>
          <label for="person">Person who conducted the balancing test:<span class="required">*</span></label>
          <input type="text" id="person" name="person" required>
          </p>
           <!-- <p>
         <label>Signature of the person who conducted the balancing test:</label>
          <input type="text" id="signature" name="signature" required>
          </p> -->
          <p>
          <label for="placeDpo">Place:<span class="required">*</span></label>
          <input type="text" id="placeDpo" name="placeDpo" required>
          </p>
          <p>
          <label for="dateDpo">Date:<span class="required">*</span></label>
          <input type="date" id="dateDpo" name="dateDpo" required>
          </p>
          <p>
          <label for="dpo">Data protection officer:<span class="required">*</span></label>
          <input type="text" id="dpo" name="dpo" required>
          </p>
          <!-- <p>
          <label>Signature of the data protection officer:</label>
          <input type="text" id="signatureDpo" name="signatureDpo" required>
          </p>  -->
          <p>
          <p>Personal data may not be used for direct marketing purposes after an objection has been filed.</p>
    
      </div>       
        <script src="BalanceTest-LegitimateInterest.js"></script> 
        <input type="button" class="button" value="Generate PDF" onclick="generatePDF()">
    </form>   
</body>
</html>

        
<!-- function submitForm() {
  // var dpiNotRequired = document.getElementById('dpiNotRequired').checked;
   //var dpiIsRequired = document.getElementById('dpiIsRequired').checked;
   //var dpiCompletedYes = document.getElementById('dpiCompletedYes').checked;
   //var notAssessed = document.getElementById('notAssessed').checked;
 
   //if (dpiIsRequired && !dpiCompletedYes) {
   //  alert('Please complete the DPIA with the data protection officer before submitting.');
   //  return false;
   //}
 
   //alert('Form submitted successfully!'); -->
 
